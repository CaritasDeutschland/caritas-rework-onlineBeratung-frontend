import {
	generateAskerSession,
	generateConsultantSession,
	generateMessagesReply,
	sessionsReply
} from '../sessions';
import { config } from '../../../src/resources/scripts/config';
import {
	getAskerSessions,
	setAskerSessions,
	updateAskerSession
} from './askerSessions';
import {
	getConsultantSessions,
	setConsultantSessions,
	updateConsultantSession
} from './consultantSessions';
import { LoginArgs, USER_ASKER } from './login';
import { deepMerge } from '../helpers';
import { decodeUsername } from '../../../src/utils/encryptionHelpers';
import { getMessages, setMessages } from './messages';
import apiAppointments from './api/appointments';
import apiVideocalls from './api/videocalls';

let overrides = {};

const defaultReturns = {
	attachmentUpload: {
		statusCode: 201
	},
	userData: {},
	consultingTypes: [],
	releases: {
		statusCode: 404
	}
};

Cypress.Commands.add('willReturn', (name: string, data: any) => {
	overrides[name] = data;
});

let username = null;

Cypress.Commands.add('mockApi', () => {
	// Empty overrides
	overrides = {};

	setAskerSessions([]);
	cy.askerSession(generateAskerSession());

	setConsultantSessions([]);
	cy.consultantSession(generateConsultantSession());
	cy.consultantSession(generateConsultantSession());
	cy.consultantSession(generateConsultantSession());

	setMessages([]);
	cy.addMessage({}, 0);
	cy.addMessage({}, 1);
	cy.addMessage({}, 2);

	// ConsultingTypes
	cy.fixture('service.consultingtypes.emigration.json').then(
		(consultingType) => {
			defaultReturns['consultingTypes'].push(consultingType);
		}
	);
	cy.fixture('service.consultingtypes.addiction.json').then(
		(consultingType) => {
			defaultReturns['consultingTypes'].push(consultingType);
		}
	);
	cy.fixture('service.consultingtypes.pregnancy.json').then(
		(consultingType) => {
			defaultReturns['consultingTypes'].push(consultingType);
		}
	);
	cy.fixture('service.consultingtypes.u25.json').then((consultingType) => {
		defaultReturns['consultingTypes'].push(consultingType);
	});

	cy.fixture('api.v1.login').then((data) => {
		cy.intercept('POST', config.endpoints.rc.accessToken, (req) => {
			username = decodeUsername(req.body.username);
			req.reply(
				deepMerge(data, {
					data: { userId: decodeUsername(req.body.username) }
				})
			);
		});
	});

	cy.fixture('auth.token').then((auth) => {
		defaultReturns['auth'] = auth;
	});

	cy.fixture('service.users.data.consultants').then((usersData) => {
		usersData.forEach((userData) => {
			defaultReturns['userData'][userData.userId] = userData;
		});
	});
	cy.fixture('service.users.data.askers').then((userData) => {
		defaultReturns['userData'][USER_ASKER] = userData;
	});

	cy.intercept('GET', `${config.endpoints.consultantSessions}*`, (req) => {
		if (overrides['consultantSessions']) {
			return req.reply(overrides['consultantSessions']);
		}

		const url = new URL(req.url);

		const offset = parseInt(url.searchParams.get('offset')) || 0;
		const count = parseInt(url.searchParams.get('count')) || 15;

		req.reply(
			sessionsReply({
				sessions: getConsultantSessions(),
				offset,
				count
			})
		);
	}).as('consultantSessions');

	cy.intercept('GET', config.endpoints.askerSessions, (req) => {
		if (overrides['askerSessions']) {
			return req.reply(overrides['askerSessions']);
		}

		req.reply({
			sessions: getAskerSessions()
		});
	}).as('askerSessions');

	cy.intercept('GET', config.endpoints.messages, (req) => {
		if (overrides['messages']) {
			return req.reply(overrides['messages']);
		}

		const url = new URL(req.url);

		req.reply(
			generateMessagesReply(
				getMessages().filter(
					(message) =>
						message.rid === url.searchParams.get('rcGroupId')
				)
			)
		);
	}).as('messages');

	cy.intercept('POST', config.endpoints.rc.subscriptions.read, (req) => {
		getAskerSessions().forEach((session, index) => {
			if (session.session.groupId === req.body.rid) {
				updateAskerSession({ session: { messagesRead: true } }, index);
			}
		});

		getConsultantSessions().forEach((session, index) => {
			if (session.session.groupId === req.body.rid) {
				updateConsultantSession(
					{ session: { messagesRead: true } },
					index
				);
			}
		});

		req.reply('{}');
	}).as('sessionRead');

	cy.intercept('GET', `${config.endpoints.consultantEnquiriesBase}*`, {}).as(
		'consultantEnquiriesBase'
	);

	cy.intercept('POST', config.endpoints.keycloakLogout, {}).as('authLogout');

	cy.intercept('POST', config.endpoints.rc.logout, {}).as('apiLogout');

	cy.intercept(`${config.endpoints.liveservice}/**/*`, {
		entropy: -1197552011,
		origins: ['*:*'],
		cookie_needed: false,
		websocket: true
	});

	cy.intercept('GET', config.endpoints.draftMessages, {}).as('draftMessages');

	cy.intercept('POST', config.endpoints.startVideoCall, {
		fixture: 'service.videocalls.new'
	}).as('startVideoCall');

	cy.intercept('POST', config.endpoints.rejectVideoCall, {}).as(
		'rejectVideoCall'
	);

	cy.intercept('POST', config.endpoints.attachmentUpload, (req) =>
		req.reply({
			...defaultReturns['attachmentUpload'],
			...(overrides['attachmentUpload'] || {})
		})
	).as('attachmentUpload');

	cy.intercept('POST', config.endpoints.keycloakAccessToken, (req) => {
		req.reply({
			...defaultReturns['auth'],
			...(overrides['auth'] || {})
		});
	}).as('authToken');

	cy.intercept('GET', config.endpoints.userData, (req) => {
		req.reply({
			...defaultReturns['userData'][username],
			...(overrides['userData'] || {})
		});
	}).as('usersData');

	cy.intercept(
		`${config.endpoints.consultingTypeServiceBase}/byslug/*/full`,
		(req) => {
			const slug = new URL(req.url).pathname.split('/')[4];

			req.reply({
				...(defaultReturns['consultingTypes'].find(
					(consultingType) => consultingType.slug === slug
				) || {}),
				...(overrides['consultingType'] || {})
			});
		}
	).as('consultingTypeServiceBySlugFull');

	cy.intercept(
		`${config.endpoints.consultingTypeServiceBase}/*/full`,
		(req) => {
			const id = parseInt(new URL(req.url).pathname.split('/')[3]);

			req.reply({
				...(defaultReturns['consultingTypes'].find(
					(consultingType) => consultingType.id === id
				) || {}),
				...(overrides['consultingType'] || {})
			});
		}
	).as('consultingTypeServiceBaseFull');

	cy.intercept(
		`${config.endpoints.consultingTypeServiceBase}/basic`,
		(req) => {
			req.reply([
				...defaultReturns['consultingTypes'],
				...(overrides['consultingTypes'] || [])
			]);
		}
	).as('consultingTypeServiceBaseBasic');

	cy.intercept('GET', '/releases/*', (req) => {
		req.reply({
			...defaultReturns['releases'],
			...(overrides['releases'] || {})
		});
	}).as('releases');

	apiAppointments(cy);
	apiVideocalls(cy);

	cy.intercept('GET', '/api/v1/e2e.fetchMyKeys', (req) => {
		// keys from dev user pregnancy
		req.reply({
			public_key:
				'{"alg":"RSA-OAEP-256","e":"AQAB","ext":true,"key_ops":["encrypt"],"kty":"RSA","n":"sHRpW1n0EbpDv9fZHCTBMFXyQJYr_Si_b7tbUfz4L-rEHrNxscZHWb3Ej6KP-OFBA6dKNhx9l_BgjlUi1c_LpD0qHUGrzM9OJQEPRKauj0zJP0U6hZVkoqEbi72h3YRZsPW6G7KYF_V5kVWJy9ZkO0abDoQ4eBcq0oxTEqVmhMG2kZBDJlUi7spPc9DwKEi8EhnJdz7gm-wfs70bSdDyDu8s9OIVvJz2zTE9erRl5zyz3YDZw-iseoLr1qnjT8T89GN-MtTIv3wLIbPDxT7L562z8BtG8qQoSWwivWdWnCp6upvAiUfmXdjj68E-NVrLRUx_m1miivDiXvID4h3MXw"}',
			private_key:
				'{"0":90,"1":67,"2":56,"3":174,"4":9,"5":141,"6":207,"7":111,"8":28,"9":207,"10":29,"11":80,"12":7,"13":29,"14":12,"15":243,"16":104,"17":163,"18":254,"19":15,"20":118,"21":198,"22":29,"23":53,"24":97,"25":199,"26":240,"27":178,"28":112,"29":180,"30":222,"31":28,"32":166,"33":230,"34":182,"35":40,"36":50,"37":87,"38":80,"39":56,"40":50,"41":101,"42":93,"43":235,"44":27,"45":147,"46":245,"47":160,"48":97,"49":108,"50":125,"51":192,"52":213,"53":113,"54":145,"55":246,"56":17,"57":176,"58":174,"59":148,"60":140,"61":143,"62":91,"63":196,"64":194,"65":132,"66":185,"67":125,"68":122,"69":12,"70":54,"71":127,"72":92,"73":103,"74":241,"75":168,"76":23,"77":246,"78":235,"79":163,"80":196,"81":123,"82":56,"83":10,"84":251,"85":114,"86":18,"87":46,"88":190,"89":49,"90":163,"91":183,"92":199,"93":215,"94":73,"95":55,"96":87,"97":84,"98":208,"99":133,"100":201,"101":226,"102":209,"103":109,"104":60,"105":148,"106":30,"107":234,"108":139,"109":234,"110":211,"111":103,"112":0,"113":208,"114":123,"115":249,"116":253,"117":37,"118":61,"119":198,"120":62,"121":89,"122":164,"123":209,"124":144,"125":100,"126":65,"127":157,"128":45,"129":80,"130":164,"131":75,"132":84,"133":199,"134":102,"135":180,"136":159,"137":30,"138":250,"139":66,"140":47,"141":238,"142":145,"143":135,"144":47,"145":89,"146":83,"147":94,"148":77,"149":251,"150":156,"151":104,"152":47,"153":32,"154":208,"155":19,"156":62,"157":108,"158":112,"159":208,"160":28,"161":127,"162":103,"163":27,"164":205,"165":114,"166":46,"167":1,"168":198,"169":145,"170":75,"171":215,"172":58,"173":169,"174":145,"175":171,"176":232,"177":15,"178":179,"179":99,"180":164,"181":80,"182":130,"183":242,"184":43,"185":179,"186":253,"187":118,"188":236,"189":39,"190":255,"191":134,"192":211,"193":94,"194":224,"195":163,"196":225,"197":14,"198":254,"199":152,"200":153,"201":194,"202":166,"203":146,"204":97,"205":103,"206":51,"207":208,"208":114,"209":39,"210":35,"211":31,"212":174,"213":57,"214":16,"215":64,"216":189,"217":75,"218":89,"219":104,"220":243,"221":175,"222":220,"223":156,"224":37,"225":242,"226":75,"227":245,"228":158,"229":233,"230":4,"231":192,"232":162,"233":46,"234":2,"235":29,"236":148,"237":75,"238":26,"239":206,"240":225,"241":86,"242":161,"243":198,"244":150,"245":89,"246":125,"247":172,"248":138,"249":22,"250":243,"251":148,"252":85,"253":54,"254":215,"255":167,"256":172,"257":95,"258":185,"259":11,"260":64,"261":241,"262":148,"263":13,"264":90,"265":82,"266":14,"267":150,"268":19,"269":197,"270":135,"271":235,"272":44,"273":18,"274":217,"275":150,"276":33,"277":223,"278":19,"279":206,"280":24,"281":73,"282":64,"283":41,"284":59,"285":163,"286":111,"287":111,"288":213,"289":206,"290":223,"291":232,"292":239,"293":250,"294":196,"295":176,"296":38,"297":97,"298":112,"299":138,"300":216,"301":35,"302":22,"303":200,"304":9,"305":212,"306":219,"307":213,"308":42,"309":37,"310":255,"311":63,"312":255,"313":70,"314":249,"315":175,"316":227,"317":181,"318":36,"319":45,"320":219,"321":23,"322":239,"323":52,"324":206,"325":222,"326":214,"327":91,"328":23,"329":149,"330":22,"331":245,"332":196,"333":10,"334":209,"335":88,"336":39,"337":146,"338":25,"339":251,"340":26,"341":98,"342":114,"343":36,"344":54,"345":85,"346":197,"347":79,"348":189,"349":56,"350":164,"351":152,"352":67,"353":242,"354":231,"355":220,"356":165,"357":60,"358":182,"359":67,"360":132,"361":167,"362":121,"363":174,"364":65,"365":99,"366":196,"367":96,"368":172,"369":250,"370":76,"371":140,"372":178,"373":210,"374":28,"375":107,"376":106,"377":28,"378":190,"379":186,"380":193,"381":9,"382":160,"383":183,"384":105,"385":53,"386":89,"387":113,"388":137,"389":43,"390":225,"391":179,"392":148,"393":93,"394":132,"395":14,"396":15,"397":241,"398":39,"399":162,"400":108,"401":116,"402":245,"403":231,"404":39,"405":48,"406":85,"407":174,"408":101,"409":252,"410":102,"411":252,"412":66,"413":68,"414":27,"415":74,"416":244,"417":229,"418":46,"419":139,"420":171,"421":153,"422":162,"423":103,"424":14,"425":97,"426":35,"427":165,"428":66,"429":165,"430":178,"431":167,"432":188,"433":229,"434":255,"435":172,"436":65,"437":153,"438":211,"439":169,"440":132,"441":108,"442":108,"443":173,"444":153,"445":35,"446":61,"447":108,"448":37,"449":45,"450":254,"451":210,"452":156,"453":118,"454":229,"455":104,"456":153,"457":73,"458":177,"459":75,"460":224,"461":203,"462":70,"463":151,"464":73,"465":82,"466":102,"467":129,"468":148,"469":115,"470":243,"471":210,"472":134,"473":30,"474":148,"475":218,"476":207,"477":53,"478":241,"479":170,"480":57,"481":228,"482":196,"483":185,"484":144,"485":201,"486":171,"487":213,"488":46,"489":65,"490":101,"491":2,"492":148,"493":1,"494":57,"495":178,"496":36,"497":227,"498":7,"499":114,"500":195,"501":168,"502":145,"503":42,"504":76,"505":106,"506":157,"507":226,"508":176,"509":167,"510":50,"511":130,"512":138,"513":213,"514":238,"515":23,"516":255,"517":215,"518":41,"519":253,"520":111,"521":103,"522":81,"523":13,"524":106,"525":19,"526":79,"527":19,"528":240,"529":193,"530":100,"531":44,"532":0,"533":4,"534":155,"535":87,"536":103,"537":74,"538":230,"539":27,"540":196,"541":61,"542":166,"543":132,"544":200,"545":152,"546":1,"547":40,"548":108,"549":199,"550":97,"551":150,"552":161,"553":26,"554":133,"555":177,"556":135,"557":197,"558":131,"559":240,"560":144,"561":45,"562":68,"563":182,"564":86,"565":234,"566":126,"567":32,"568":173,"569":243,"570":68,"571":149,"572":246,"573":196,"574":187,"575":143,"576":92,"577":193,"578":249,"579":164,"580":7,"581":39,"582":115,"583":206,"584":236,"585":57,"586":233,"587":121,"588":200,"589":211,"590":33,"591":151,"592":168,"593":76,"594":53,"595":158,"596":167,"597":229,"598":148,"599":109,"600":56,"601":88,"602":229,"603":71,"604":221,"605":178,"606":249,"607":74,"608":70,"609":122,"610":248,"611":29,"612":90,"613":232,"614":207,"615":183,"616":163,"617":235,"618":49,"619":64,"620":206,"621":50,"622":0,"623":59,"624":33,"625":168,"626":227,"627":94,"628":91,"629":209,"630":182,"631":159,"632":209,"633":101,"634":66,"635":229,"636":254,"637":135,"638":130,"639":166,"640":88,"641":10,"642":234,"643":107,"644":151,"645":205,"646":73,"647":68,"648":174,"649":167,"650":176,"651":179,"652":141,"653":213,"654":13,"655":174,"656":108,"657":125,"658":3,"659":221,"660":87,"661":80,"662":66,"663":30,"664":129,"665":197,"666":37,"667":101,"668":78,"669":247,"670":146,"671":136,"672":71,"673":82,"674":60,"675":132,"676":156,"677":146,"678":38,"679":221,"680":109,"681":131,"682":147,"683":157,"684":98,"685":192,"686":13,"687":0,"688":145,"689":154,"690":129,"691":86,"692":107,"693":117,"694":148,"695":167,"696":206,"697":146,"698":208,"699":140,"700":121,"701":162,"702":236,"703":231,"704":43,"705":14,"706":104,"707":218,"708":37,"709":196,"710":106,"711":67,"712":37,"713":220,"714":96,"715":176,"716":251,"717":106,"718":55,"719":171,"720":44,"721":9,"722":87,"723":66,"724":113,"725":117,"726":9,"727":249,"728":235,"729":71,"730":245,"731":151,"732":221,"733":233,"734":38,"735":196,"736":158,"737":81,"738":177,"739":20,"740":243,"741":69,"742":124,"743":12,"744":176,"745":78,"746":87,"747":71,"748":239,"749":96,"750":138,"751":200,"752":249,"753":111,"754":78,"755":126,"756":159,"757":244,"758":172,"759":215,"760":69,"761":55,"762":142,"763":166,"764":2,"765":179,"766":143,"767":36,"768":194,"769":86,"770":7,"771":8,"772":235,"773":140,"774":151,"775":229,"776":169,"777":33,"778":90,"779":200,"780":11,"781":16,"782":212,"783":113,"784":42,"785":80,"786":227,"787":218,"788":118,"789":119,"790":236,"791":32,"792":87,"793":127,"794":189,"795":206,"796":92,"797":187,"798":80,"799":37,"800":90,"801":148,"802":122,"803":180,"804":56,"805":102,"806":39,"807":97,"808":111,"809":230,"810":166,"811":158,"812":233,"813":70,"814":17,"815":11,"816":140,"817":239,"818":210,"819":108,"820":228,"821":126,"822":141,"823":12,"824":0,"825":180,"826":144,"827":177,"828":88,"829":141,"830":46,"831":225,"832":190,"833":149,"834":32,"835":241,"836":147,"837":229,"838":247,"839":143,"840":62,"841":251,"842":103,"843":174,"844":147,"845":65,"846":3,"847":44,"848":141,"849":62,"850":241,"851":12,"852":203,"853":23,"854":31,"855":217,"856":165,"857":255,"858":222,"859":46,"860":85,"861":78,"862":86,"863":60,"864":9,"865":190,"866":60,"867":231,"868":227,"869":240,"870":143,"871":134,"872":9,"873":146,"874":38,"875":87,"876":52,"877":207,"878":59,"879":115,"880":207,"881":68,"882":121,"883":247,"884":155,"885":152,"886":109,"887":153,"888":142,"889":98,"890":3,"891":56,"892":94,"893":83,"894":57,"895":22,"896":64,"897":144,"898":179,"899":119,"900":243,"901":43,"902":146,"903":180,"904":59,"905":247,"906":92,"907":72,"908":52,"909":115,"910":117,"911":153,"912":151,"913":65,"914":42,"915":44,"916":229,"917":188,"918":197,"919":121,"920":14,"921":0,"922":15,"923":80,"924":227,"925":73,"926":205,"927":95,"928":142,"929":59,"930":240,"931":221,"932":113,"933":248,"934":183,"935":23,"936":178,"937":149,"938":247,"939":112,"940":245,"941":7,"942":241,"943":78,"944":114,"945":70,"946":193,"947":64,"948":238,"949":170,"950":160,"951":36,"952":44,"953":15,"954":138,"955":82,"956":58,"957":74,"958":181,"959":83,"960":74,"961":111,"962":33,"963":163,"964":145,"965":39,"966":245,"967":90,"968":219,"969":178,"970":163,"971":161,"972":62,"973":171,"974":80,"975":242,"976":245,"977":45,"978":194,"979":28,"980":42,"981":16,"982":255,"983":21,"984":159,"985":52,"986":220,"987":184,"988":243,"989":59,"990":180,"991":226,"992":243,"993":180,"994":117,"995":57,"996":228,"997":121,"998":109,"999":208,"1000":163,"1001":91,"1002":11,"1003":177,"1004":106,"1005":116,"1006":164,"1007":47,"1008":116,"1009":152,"1010":93,"1011":23,"1012":211,"1013":232,"1014":73,"1015":198,"1016":254,"1017":250,"1018":116,"1019":88,"1020":101,"1021":129,"1022":7,"1023":130,"1024":181,"1025":213,"1026":102,"1027":118,"1028":99,"1029":100,"1030":126,"1031":223,"1032":214,"1033":36,"1034":113,"1035":127,"1036":215,"1037":7,"1038":52,"1039":68,"1040":73,"1041":152,"1042":164,"1043":25,"1044":2,"1045":75,"1046":118,"1047":90,"1048":127,"1049":245,"1050":180,"1051":254,"1052":250,"1053":204,"1054":138,"1055":117,"1056":179,"1057":30,"1058":228,"1059":186,"1060":50,"1061":147,"1062":183,"1063":0,"1064":3,"1065":183,"1066":229,"1067":2,"1068":79,"1069":166,"1070":249,"1071":61,"1072":70,"1073":116,"1074":119,"1075":245,"1076":100,"1077":86,"1078":145,"1079":37,"1080":31,"1081":169,"1082":116,"1083":71,"1084":161,"1085":212,"1086":66,"1087":226,"1088":112,"1089":191,"1090":169,"1091":60,"1092":118,"1093":182,"1094":135,"1095":82,"1096":166,"1097":111,"1098":149,"1099":156,"1100":164,"1101":101,"1102":17,"1103":66,"1104":181,"1105":0,"1106":30,"1107":115,"1108":120,"1109":218,"1110":142,"1111":60,"1112":108,"1113":107,"1114":50,"1115":157,"1116":149,"1117":33,"1118":225,"1119":240,"1120":255,"1121":195,"1122":160,"1123":157,"1124":44,"1125":10,"1126":128,"1127":178,"1128":198,"1129":224,"1130":197,"1131":69,"1132":61,"1133":74,"1134":20,"1135":79,"1136":53,"1137":174,"1138":29,"1139":233,"1140":52,"1141":242,"1142":38,"1143":177,"1144":183,"1145":29,"1146":111,"1147":89,"1148":30,"1149":206,"1150":37,"1151":213,"1152":14,"1153":169,"1154":116,"1155":112,"1156":221,"1157":190,"1158":136,"1159":26,"1160":137,"1161":254,"1162":109,"1163":59,"1164":12,"1165":86,"1166":45,"1167":81,"1168":178,"1169":213,"1170":178,"1171":109,"1172":23,"1173":38,"1174":245,"1175":117,"1176":199,"1177":236,"1178":119,"1179":124,"1180":213,"1181":187,"1182":130,"1183":85,"1184":123,"1185":220,"1186":61,"1187":97,"1188":63,"1189":205,"1190":231,"1191":129,"1192":92,"1193":228,"1194":48,"1195":105,"1196":51,"1197":255,"1198":138,"1199":209,"1200":49,"1201":191,"1202":244,"1203":30,"1204":74,"1205":3,"1206":198,"1207":53,"1208":240,"1209":105,"1210":43,"1211":61,"1212":104,"1213":197,"1214":16,"1215":0,"1216":102,"1217":89,"1218":104,"1219":108,"1220":63,"1221":114,"1222":188,"1223":90,"1224":126,"1225":72,"1226":23,"1227":202,"1228":200,"1229":5,"1230":99,"1231":30,"1232":212,"1233":70,"1234":184,"1235":211,"1236":94,"1237":4,"1238":95,"1239":91,"1240":83,"1241":195,"1242":182,"1243":117,"1244":40,"1245":173,"1246":16,"1247":9,"1248":56,"1249":237,"1250":160,"1251":12,"1252":206,"1253":169,"1254":82,"1255":253,"1256":83,"1257":179,"1258":197,"1259":44,"1260":76,"1261":243,"1262":122,"1263":103,"1264":231,"1265":108,"1266":27,"1267":20,"1268":100,"1269":10,"1270":48,"1271":25,"1272":84,"1273":99,"1274":242,"1275":17,"1276":22,"1277":23,"1278":64,"1279":68,"1280":79,"1281":67,"1282":74,"1283":177,"1284":170,"1285":12,"1286":152,"1287":239,"1288":249,"1289":174,"1290":237,"1291":117,"1292":204,"1293":207,"1294":118,"1295":58,"1296":40,"1297":209,"1298":72,"1299":216,"1300":130,"1301":92,"1302":94,"1303":128,"1304":123,"1305":155,"1306":77,"1307":76,"1308":182,"1309":216,"1310":235,"1311":211,"1312":112,"1313":202,"1314":57,"1315":111,"1316":149,"1317":129,"1318":6,"1319":27,"1320":122,"1321":181,"1322":116,"1323":183,"1324":200,"1325":49,"1326":51,"1327":37,"1328":49,"1329":35,"1330":236,"1331":168,"1332":40,"1333":151,"1334":180,"1335":168,"1336":203,"1337":121,"1338":255,"1339":17,"1340":192,"1341":129,"1342":191,"1343":200,"1344":161,"1345":113,"1346":41,"1347":46,"1348":171,"1349":166,"1350":30,"1351":184,"1352":241,"1353":152,"1354":0,"1355":18,"1356":237,"1357":107,"1358":235,"1359":78,"1360":200,"1361":61,"1362":247,"1363":15,"1364":220,"1365":213,"1366":13,"1367":106,"1368":26,"1369":145,"1370":95,"1371":17,"1372":86,"1373":121,"1374":40,"1375":120,"1376":100,"1377":23,"1378":141,"1379":112,"1380":159,"1381":10,"1382":162,"1383":46,"1384":153,"1385":89,"1386":80,"1387":150,"1388":63,"1389":243,"1390":171,"1391":39,"1392":106,"1393":89,"1394":248,"1395":75,"1396":81,"1397":30,"1398":160,"1399":61,"1400":91,"1401":63,"1402":150,"1403":204,"1404":45,"1405":254,"1406":224,"1407":218,"1408":14,"1409":147,"1410":132,"1411":97,"1412":164,"1413":224,"1414":180,"1415":196,"1416":53,"1417":30,"1418":1,"1419":248,"1420":120,"1421":86,"1422":5,"1423":53,"1424":101,"1425":232,"1426":87,"1427":98,"1428":49,"1429":20,"1430":174,"1431":85,"1432":148,"1433":175,"1434":37,"1435":72,"1436":210,"1437":214,"1438":123,"1439":164,"1440":65,"1441":235,"1442":129,"1443":213,"1444":80,"1445":172,"1446":86,"1447":202,"1448":71,"1449":18,"1450":44,"1451":193,"1452":255,"1453":47,"1454":114,"1455":11,"1456":1,"1457":216,"1458":77,"1459":115,"1460":10,"1461":107,"1462":113,"1463":157,"1464":199,"1465":231,"1466":80,"1467":29,"1468":255,"1469":52,"1470":203,"1471":192,"1472":250,"1473":16,"1474":36,"1475":153,"1476":3,"1477":86,"1478":36,"1479":70,"1480":184,"1481":183,"1482":221,"1483":2,"1484":228,"1485":139,"1486":35,"1487":95,"1488":148,"1489":138,"1490":132,"1491":73,"1492":143,"1493":234,"1494":34,"1495":242,"1496":213,"1497":44,"1498":9,"1499":4,"1500":127,"1501":90,"1502":120,"1503":248,"1504":122,"1505":0,"1506":222,"1507":183,"1508":92,"1509":150,"1510":181,"1511":47,"1512":221,"1513":117,"1514":196,"1515":90,"1516":163,"1517":2,"1518":89,"1519":13,"1520":153,"1521":16,"1522":234,"1523":53,"1524":243,"1525":15,"1526":68,"1527":40,"1528":30,"1529":213,"1530":238,"1531":211,"1532":198,"1533":46,"1534":123,"1535":226,"1536":230,"1537":57,"1538":0,"1539":104,"1540":86,"1541":119,"1542":49,"1543":25,"1544":174,"1545":51,"1546":226,"1547":17,"1548":189,"1549":11,"1550":45,"1551":18,"1552":219,"1553":157,"1554":179,"1555":195,"1556":58,"1557":93,"1558":111,"1559":88,"1560":142,"1561":158,"1562":136,"1563":32,"1564":29,"1565":170,"1566":139,"1567":79,"1568":165,"1569":90,"1570":157,"1571":229,"1572":161,"1573":164,"1574":90,"1575":214,"1576":14,"1577":136,"1578":217,"1579":53,"1580":195,"1581":53,"1582":152,"1583":0,"1584":240,"1585":200,"1586":9,"1587":81,"1588":32,"1589":235,"1590":76,"1591":255,"1592":64,"1593":52,"1594":86,"1595":167,"1596":54,"1597":20,"1598":163,"1599":227,"1600":219,"1601":200,"1602":140,"1603":200,"1604":99,"1605":85,"1606":32,"1607":117,"1608":170,"1609":10,"1610":26,"1611":135,"1612":45,"1613":31,"1614":230,"1615":18,"1616":75,"1617":216,"1618":227,"1619":16,"1620":76,"1621":214,"1622":37,"1623":100,"1624":70,"1625":61,"1626":111,"1627":138,"1628":206,"1629":38,"1630":195,"1631":252,"1632":12,"1633":11,"1634":66,"1635":106,"1636":204,"1637":202,"1638":22,"1639":90,"1640":63,"1641":185,"1642":159,"1643":88,"1644":32,"1645":39,"1646":47,"1647":57,"1648":208,"1649":123,"1650":155,"1651":102,"1652":215,"1653":130,"1654":79,"1655":198,"1656":233,"1657":169,"1658":173,"1659":198,"1660":120,"1661":115,"1662":6,"1663":148,"1664":54,"1665":25,"1666":76,"1667":245,"1668":170,"1669":176,"1670":241,"1671":55,"1672":159,"1673":168,"1674":140,"1675":184,"1676":224,"1677":237,"1678":243,"1679":4,"1680":100,"1681":75,"1682":166,"1683":191,"1684":42,"1685":184,"1686":126,"1687":56,"1688":193,"1689":150,"1690":134,"1691":189,"1692":21,"1693":106,"1694":18,"1695":55}',
			success: true
		});
	}).as('fetchMyKeys');

	cy.intercept('POST', '/api/v1/e2e.setUserPublicAndPrivateKeys', (req) => {
		req.reply({
			success: true
		});
	}).as('setUserPublicAndPrivateKeys');
});

Cypress.Commands.add(
	'fastLogin',
	(
		args: LoginArgs = {
			username: USER_ASKER
		}
	) => {
		username = args.username || USER_ASKER;

		cy.fixture('api.v1.login').then((res) => {
			if (res.data.authToken) {
				cy.setCookie('rc_token', res.data.authToken);
			}
			if (res.data.userId) {
				cy.setCookie('rc_uid', res.data.userId);
				// masterkey dev user pregnancy
				window.localStorage.setItem(
					`mk_${res.data.userId}`,
					'[199,240,181,57,179,147,14,229,26,246,83,29,32,178,65,4,84,43,174,198,241,255,159,187,241,169,242,129,165,252,216,174]'
				);
			}
		});

		const tomorrow = new Date();
		tomorrow.setDate(tomorrow.getDate() + 1);

		window.localStorage.setItem(
			'auth.access_token_valid_until',
			tomorrow.getTime().toString()
		);
		window.localStorage.setItem(
			'auth.refresh_token_valid_until',
			tomorrow.getTime().toString()
		);

		cy.visit('/app');
		cy.wait('@usersData');
		if (username === USER_ASKER) {
			cy.wait('@askerSessions');
		} else {
			cy.wait('@consultantEnquiriesBase');
		}
	}
);
